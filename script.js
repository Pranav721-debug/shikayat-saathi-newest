// ----------------------------
// LANGUAGE PROMPTS
// ----------------------------
const prompts = {
  hi: ["à¤•à¥ƒà¤ªà¤¯à¤¾ à¤…à¤ªà¤¨à¥€ à¤¸à¤®à¤¸à¥à¤¯à¤¾ à¤¬à¤¤à¤¾à¤à¤‚", "à¤•à¥ƒà¤ªà¤¯à¤¾ à¤…à¤ªà¤¨à¥‡ à¤—à¤¾à¤‚à¤µ à¤”à¤° à¤°à¤¾à¤œà¥à¤¯ à¤•à¤¾ à¤¨à¤¾à¤® à¤¬à¤¤à¤¾à¤à¤‚", "à¤•à¥ƒà¤ªà¤¯à¤¾ à¤…à¤ªà¤¨à¤¾ à¤¨à¤¾à¤® à¤¬à¤¤à¤¾à¤à¤‚", "à¤§à¤¨à¥à¤¯à¤µà¤¾à¤¦, à¤†à¤ªà¤•à¥€ à¤¸à¤®à¤¸à¥à¤¯à¤¾ à¤°à¤¿à¤•à¥‰à¤°à¥à¤¡ à¤•à¤° à¤²à¥€ à¤—à¤ˆ à¤¹à¥ˆ", "à¤†à¤ªà¤•à¤¾ à¤¸à¤¹à¤¾à¤¯à¤•", "à¤¬à¥‹à¤²à¥‡à¤‚"],
  kn: ["à²¦à²¯à²µà²¿à²Ÿà³à²Ÿà³ à²¨à²¿à²®à³à²® à²¸à²®à²¸à³à²¯à³†à²¯à²¨à³à²¨à³ à²¹à³‡à²³à²¿", "à²¦à²¯à²µà²¿à²Ÿà³à²Ÿà³ à²¨à²¿à²®à³à²® à²¹à²³à³à²³à²¿ à²®à²¤à³à²¤à³ à²°à²¾à²œà³à²¯à²¦ à²¹à³†à²¸à²°à²¨à³à²¨à³ à²¹à³‡à²³à²¿", "à²¦à²¯à²µà²¿à²Ÿà³à²Ÿà³ à²¨à²¿à²®à³à²® à²¹à³†à²¸à²°à²¨à³à²¨à³ à²¹à³‡à²³à²¿", "à²§à²¨à³à²¯à²µà²¾à²¦à²—à²³à³, à²¨à²¿à²®à³à²® à²¸à²®à²¸à³à²¯à³† à²¦à²¾à²–à²²à²¾à²—à²¿à²¦à³†", "à²¨à²¿à²®à³à²® à²¸à²¹à²¾à²¯à²•", "à²®à²¾à²¤à²¨à²¾à²¡à²¿"],
  ta: ["à®¤à®¯à®µà¯à®šà¯†à®¯à¯à®¤à¯ à®‰à®™à¯à®•à®³à¯ à®ªà®¿à®°à®šà¯à®šà®©à¯ˆà®¯à¯ˆ à®•à¯‚à®±à¯à®™à¯à®•à®³à¯", "à®¤à®¯à®µà¯à®šà¯†à®¯à¯à®¤à¯ à®‰à®™à¯à®•à®³à¯ à®•à®¿à®°à®¾à®®à®®à¯ à®®à®±à¯à®±à¯à®®à¯ à®®à®¾à®¨à®¿à®²à®¤à¯à®¤à®¿à®©à¯ à®ªà¯†à®¯à®°à¯ˆ à®•à¯‚à®±à¯à®™à¯à®•à®³à¯", "à®¤à®¯à®µà¯à®šà¯†à®¯à¯à®¤à¯ à®‰à®™à¯à®•à®³à¯ à®ªà¯†à®¯à®°à¯ˆ à®•à¯‚à®±à¯à®™à¯à®•à®³à¯", "à®¨à®©à¯à®±à®¿, à®‰à®™à¯à®•à®³à¯ à®ªà®¿à®°à®šà¯à®šà®©à¯ˆ à®ªà®¤à®¿à®µà¯ à®šà¯†à®¯à¯à®¯à®ªà¯à®ªà®Ÿà¯à®Ÿà¯à®³à¯à®³à®¤à¯", "à®‰à®™à¯à®•à®³à¯ à®‰à®¤à®µà®¿à®¯à®¾à®³à®°à¯", "à®ªà¯‡à®šà®µà¯à®®à¯"],
  ur: ["Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø§Ù¾Ù†ÛŒ Ù…Ø³Ø¦Ù„Û Ø¨ØªØ§Ø¦ÛŒÚº", "Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø§Ù¾Ù†Û’ Ú¯Ø§Ø¤Úº Ø§ÙˆØ± Ø±ÛŒØ§Ø³Øª Ú©Ø§ Ù†Ø§Ù… Ø¨ØªØ§Ø¦ÛŒÚº", "Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø§Ù¾Ù†Ø§ Ù†Ø§Ù… Ø¨ØªØ§Ø¦ÛŒÚº", "Ø´Ú©Ø±ÛŒÛØŒ Ø¢Ù¾ Ú©Ø§ Ù…Ø³Ø¦Ù„Û Ø±ÛŒÚ©Ø§Ø±Úˆ Ú©Ø± Ù„ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’", "Ø¢Ù¾ Ú©Ø§ Ù…Ø¹Ø§ÙˆÙ†", "Ø¨ÙˆÙ„ÛŒÚº"],
  gu: ["àª•à«ƒàªªàª¾ àª•àª°à«€àª¨à«‡ àª¤àª®àª¾àª°à«€×‘×¢×™×” àª•àª¹à«‹", "àª¤àª®àª¾àª°àª¾ àª—àª¾àª® àª…àª¨à«‡ àª°àª¾àªœà«àª¯àª¨à«àª‚ àª¨àª¾àª® àª•àª¹à«‹", "àª¤àª®àª¾àª°à«àª‚ àª¨àª¾àª® àª•àª¹à«‹", "àª†àª­àª¾àª°, àª¤àª®àª¾àª°à«€ àª¸àª®àª¸à«àª¯àª¾ àª¨à«‹àª‚àª§àª¾àªˆ àª—àªˆ àª›à«‡", "àª¤àª®àª¾àª°à«‹ àª¸àª¹àª¾àª¯àª•", "àª¬à«‹àª²à«‹"],
  bn: ["à¦†à¦ªà¦¨à¦¾à¦° à¦¸à¦®à¦¸à§à¦¯à¦¾à¦Ÿà¦¿ à¦¬à¦²à§à¦¨", "à¦†à¦ªà¦¨à¦¾à¦° à¦—à§à¦°à¦¾à¦® à¦à¦¬à¦‚ à¦°à¦¾à¦œà§à¦¯à§‡à¦° à¦¨à¦¾à¦® à¦¬à¦²à§à¦¨", "à¦†à¦ªà¦¨à¦¾à¦° à¦¨à¦¾à¦® à¦¬à¦²à§à¦¨", "à¦§à¦¨à§à¦¯à¦¬à¦¾à¦¦, à¦†à¦ªà¦¨à¦¾à¦° à¦¸à¦®à¦¸à§à¦¯à¦¾à¦Ÿà¦¿ à¦°à§‡à¦•à¦°à§à¦¡ à¦•à¦°à¦¾ à¦¹à¦¯à¦¼à§‡à¦›à§‡", "à¦†à¦ªà¦¨à¦¾à¦° à¦¸à¦¹à¦¾à¦¯à¦¼à¦•", "à¦¬à¦²à§à¦¨"],
  or: ["à¬¦à­Ÿà¬¾à¬•à¬°à¬¿ à¬†à¬ªà¬£à¬™à­à¬•à¬° à¬¸à¬®à¬¸à­à­Ÿà¬¾ à¬•à­ à¬•à­à¬¹à¬¨à­à¬¤à­", "à¬†à¬ªà¬£à¬™à­à¬• à¬—à¬¾à¬ à¬“ à¬°à¬¾à¬œà­à­Ÿà¬° à¬¨à¬¾à¬® à¬•à­à¬¹à¬¨à­à¬¤à­", "à¬†à¬ªà¬£à¬™à­à¬• à¬¨à¬¾à¬® à¬•à­à¬¹à¬¨à­à¬¤à­", "à¬§à¬¨à­à­Ÿà¬¬à¬¾à¬¦, à¬†à¬ªà¬£à¬™à­à¬• à¬¸à¬®à¬¸à­à­Ÿà¬¾ à¬°à­‡à¬•à¬°à­à¬¡ à¬¹à­‹à¬‡à¬›à¬¿", "à¬†à¬ªà¬£à¬™à­à¬• à¬¸à¬¹à¬¾à­Ÿà¬•", "à¬•à­à¬¹à¬¨à­à¬¤à­"],
  raj: ["à¤•à¥ƒà¤ªà¤¯à¤¾ à¤¥à¤¾à¤°à¥€ à¤¸à¤®à¤¸à¥à¤¸à¥à¤¯à¤¾ à¤¬à¤¤à¤¾à¤µà¥‹", "à¤¥à¤¾à¤°à¥‹ à¤—à¤¾à¤‚à¤µ à¤…à¤° à¤°à¤¾à¤œà¥à¤¯ à¤•à¥‹ à¤¨à¤¾à¤® à¤¬à¥‹à¤²à¥‹", "à¤¥à¤¾à¤°à¥‹ à¤¨à¤¾à¤® à¤¬à¤¤à¤¾à¤µà¥‹", "à¤§à¤¨à¥à¤¯à¤µà¤¾à¤¦, à¤¥à¤¾à¤°à¥€ à¤¸à¤®à¤¸à¥à¤¸à¥à¤¯à¤¾ à¤°à¤¿à¤•à¥‰à¤°à¥à¤¡ à¤•à¤° à¤²à¥€ à¤—à¤ˆ à¤¹à¥ˆ", "à¤¥à¤¾à¤°à¥‹ à¤¸à¤¹à¤¾à¤¯à¤•", "à¤¬à¥‹à¤²à¥‹"]
};

// ----------------------------
// GOOGLE TRANSLATE TTS FUNCTION
// ----------------------------
function speak(text, langCode) {
  const audio = new Audio(
    `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodeURIComponent(text)}&tl=${langCode}&client=tw-ob`
  );
  audio.play();
}

// Language â†’ TTS language codes
const ttsLang = {
  hi: "hi-IN",
  kn: "kn-IN",
  ta: "ta-IN",
  ur: "ur",
  gu: "gu",
  bn: "bn",
  or: "or",
  raj: "hi-IN"
};

// ----------------------------
// MAIN LOGIC
// ----------------------------
let currentLang = "hi";
let step = 0;

function selectLanguage(lang) {
  currentLang = lang;
  step = 0;

  document.getElementById("stepText").innerText = prompts[lang][0];
  document.getElementById("slogan").innerText = prompts[lang][4];
  document.getElementById("micButton").innerText = "ðŸŽ¤ " + prompts[lang][5];

  speak(prompts[lang][0], ttsLang[lang]);
}

window.startRecognition = function () {
  if (!("webkitSpeechRecognition" in window)) {
    alert("Speech recognition not supported.");
    return;
  }

  const recogLang = {
    hi: "hi-IN",
    kn: "kn-IN",
    ta: "ta-IN",
    ur: "ur-PK",
    gu: "gu-IN",
    bn: "bn-IN",
    or: "or-IN",
    raj: "hi-IN"
  };

  const recognition = new webkitSpeechRecognition();
  recognition.lang = recogLang[currentLang] || "en-US";
  recognition.interimResults = false;

  recognition.onresult = (event) => {
    const text = event.results[0][0].transcript.trim();
    const resultBox = document.getElementById("resultText");

    resultBox.innerText += (resultBox.innerText ? "\n" : "") + text;

    step++;

    if (step < 3) {
      document.getElementById("stepText").innerText = prompts[currentLang][step];
      speak(prompts[currentLang][step], ttsLang[currentLang]);
      setTimeout(() => recognition.start(), 2000);
    } else {
      document.getElementById("stepText").innerText = prompts[currentLang][3];
      speak(prompts[currentLang][3], ttsLang[currentLang]);

      const lines = resultBox.innerText.split("\n");
      const problem = lines[0] || "";
      const village = lines[1] || "";
      const name = lines[2] || "";

      navigator.geolocation.getCurrentPosition(
        (pos) =>
          sendComplaintToFirebase(
            name,
            village,
            problem,
            pos.coords.latitude,
            pos.coords.longitude
          ),
        () => alert("Location denied.")
      );

      step = 0;
    }
  };

  speak(prompts[currentLang][step], ttsLang[currentLang]);
  setTimeout(() => recognition.start(), 1500);
};
